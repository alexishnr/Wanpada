{"version":3,"sources":["commands/build/auth.js"],"names":["creds","spawnAndCollectJSONOutputAsync","FASTLANE","validate_apple_credentials","appleId","password","getTeamsAttempt","result","reason","rawDump","Error","teams","length","NO_TEAM_ID","teamId","teamChoices","map","team","i","forEach","console","log","choice","type","name","message","choices","answers","indexOf","validateCredentialsProduceTeamId","DEBUG","warn","APPLE_ERRORS","process","platform","match","version","username","split","access","WSL_BASH","constants","F_OK","ENABLE_WSL","prepareLocalAuth","metadata","args","bundleIdentifier","experienceName","app_management","revokeProvisioningProfile","distOrPush","isEnterprise","dumpExistingCertsAttempt","certs","trimmedOneLiners","s","trim","replace","join","revokeTheseCerts","certIds","slice","askWhichCertsToDump","ids","push","revokeCredentialsOnApple","program","prgm","cmd","race","resolve","reject","setTimeout","timeout_msg","TIMEOUT","jsonContent","WSL_ONLY_PATH","windowsToWSLPath","child","spawn","opts","wrapped","e","stdout","on","d","toString","stderr","Buffer","concat","JSON","parse","createAppOnPortal","ensureAppIdLocally","produceProvisionProfile","producePushCerts","produceCerts","require","NO_BUNDLE_ID","MULTIPLE_PROFILES","env","EXPO_DEBUG","doesFileProvidedExist","printOut","p12Path","stat","stats","isFile","doFastlaneActionsExist","all","action","path","doesExist","appStoreAction","credentials","fetch_new_provisioning_profile","fetch_push_cert","fetch_cert","noSlashes","p","MINUTES","stdio"],"mappings":"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","file":"../../../commands/build/auth.js","sourcesContent":["// Getting an undefined anywhere here probably means a ruby script is throwing an exception\nimport child_process from 'child_process';\nimport slash from 'slash';\nimport spawnAsync from '@expo/spawn-async';\nimport { basename } from 'path';\nimport fs from 'fs-extra';\nimport { release, userInfo } from 'os';\n\nimport prompt from '../../prompt';\nimport log from '../../log';\n\nconst FASTLANE =\n  process.platform === 'darwin'\n    ? require('@expo/traveling-fastlane-darwin')()\n    : require('@expo/traveling-fastlane-linux')();\n\nconst WSL_BASH = 'C:\\\\Windows\\\\system32\\\\bash.exe';\n\nconst WSL_ONLY_PATH = 'PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin';\n\nexport const NO_BUNDLE_ID = 'App could not be found for bundle id';\n\nexport const APPLE_ERRORS = `If you get errors about\n\n'Maximum number of certificates generated' or 'duplicate profiles'\n\nthen consider using the flags --revoke-apple-dist-certs, --revoke-apple-push-certs,\nand --revoke-apple-provisioning-profile or go to developer.apple.com\nand revoke those credentials manually\n`;\n\nexport const MULTIPLE_PROFILES = 'Multiple profiles found with the name';\n\nexport const DEBUG = process.env.EXPO_DEBUG && process.env.EXPO_DEBUG === 'true';\n\nconst ENABLE_WSL = `\nDoes not seem like WSL enabled on this machine. Download from the Windows app\nstore a distribution of Linux, then in an admin powershell, please run:\n\nEnable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux\n\nand run the new Linux installation at least once\n`;\n\nexport const doesFileProvidedExist = async (printOut, p12Path) => {\n  try {\n    const stats = await fs.stat(p12Path);\n    return stats.isFile();\n  } catch (e) {\n    if (printOut) {\n      console.log('\\nFile does not exist.');\n    }\n    return false;\n  }\n};\n\nexport const doFastlaneActionsExist = async () => {\n  return Promise.all(\n    Object.keys(FASTLANE).map(async action => {\n      let path = FASTLANE[action];\n      return { action, path, doesExist: await doesFileProvidedExist(false, path) };\n    })\n  );\n};\n\nfunction appStoreAction(creds, metadata, teamId, action) {\n  const args = [\n    action,\n    creds.appleId,\n    creds.password,\n    teamId,\n    metadata.bundleIdentifier,\n    metadata.experienceName,\n    '[]',\n    'false',\n  ];\n  return spawnAndCollectJSONOutputAsync(FASTLANE.app_management, args);\n}\n\nexport function createAppOnPortal(creds, metadata, teamId) {\n  return appStoreAction(creds, metadata, teamId, 'create');\n}\n\nexport function ensureAppIdLocally(creds, metadata, teamId) {\n  return appStoreAction(creds, metadata, teamId, 'verify');\n}\n\nexport function produceProvisionProfile(credentials, { bundleIdentifier }, teamId, isEnterprise) {\n  return spawnAndCollectJSONOutputAsync(FASTLANE.fetch_new_provisioning_profile, [\n    credentials.appleId,\n    credentials.password,\n    bundleIdentifier,\n    teamId,\n    isEnterprise,\n  ]);\n}\n\nexport function producePushCerts(credentials, { bundleIdentifier }, teamId, isEnterprise) {\n  return spawnAndCollectJSONOutputAsync(FASTLANE.fetch_push_cert, [\n    credentials.appleId,\n    credentials.password,\n    bundleIdentifier,\n    teamId,\n    isEnterprise,\n  ]);\n}\n\nexport function produceCerts(credentials, teamId, isEnterprise) {\n  return spawnAndCollectJSONOutputAsync(FASTLANE.fetch_cert, [\n    credentials.appleId,\n    credentials.password,\n    teamId,\n    isEnterprise,\n  ]);\n}\n\nconst NO_TEAM_ID = `You have no team ID associated with your apple account, cannot proceed.\n(Do you have a paid Apple developer Account?)`;\n\nexport async function validateCredentialsProduceTeamId(creds) {\n  const getTeamsAttempt = await spawnAndCollectJSONOutputAsync(\n    FASTLANE.validate_apple_credentials,\n    [creds.appleId, creds.password]\n  );\n  if (getTeamsAttempt.result === 'failure') {\n    const { reason, rawDump } = getTeamsAttempt;\n    throw new Error(`Reason:${reason}, raw:${JSON.stringify(rawDump)}`);\n  }\n  const { teams } = getTeamsAttempt;\n  if (teams.length === 0) {\n    throw new Error(NO_TEAM_ID);\n  }\n  if (teams.length === 1) {\n    log(`Only 1 team associated with your account, using Team ID: ${teams[0].teamId}`);\n    return { teamId: teams[0].teamId };\n  } else {\n    log(`You have ${teams.length} teams`);\n    const teamChoices = teams.map(\n      (team, i) => `${i + 1}) ${team['teamId']} \"${team['name']}\" (${team['type']})`\n    );\n    teamChoices.forEach(choice => console.log(choice));\n    const answers = await prompt({\n      type: 'list',\n      name: 'choice',\n      message: `Which Team ID to use?`,\n      choices: teamChoices,\n    });\n    return { teamId: teams[teamChoices.indexOf(answers.choice)].teamId };\n  }\n}\n\nconst windowsToWSLPath = p => {\n  const noSlashes = slash(p);\n  return noSlashes.slice(2, noSlashes.length);\n};\n\nconst MINUTES = 10;\n\nconst TIMEOUT = 60 * 1000 * MINUTES;\n\nconst timeout_msg = (prgm, args) =>\n  process.platform === 'win32'\n    ? `Took too long (limit is ${MINUTES} minutes) to execute ${prgm} ${args.join(' ')}.\nIs your WSL working? in Powershell try: bash.exe -c 'uname'`\n    : `Took too long (limit is ${MINUTES} minutes) to execute ${prgm} ${args.join(' ')}`;\n\nconst opts = { stdio: ['inherit', 'pipe', 'pipe'] };\n\nexport async function prepareLocalAuth() {\n  if (DEBUG) {\n    log.warn(APPLE_ERRORS);\n  }\n\n  if (process.platform === 'win32') {\n    const [version] = release().match(/\\d./);\n    if (version !== '10') {\n      log.warn('Must be on at least Windows version 10 for WSL support to work');\n    }\n    const { username } = userInfo();\n    if (username && username.split(' ').length !== 1) {\n      log.warn('Your username should not have empty space in it, exp might fail');\n    }\n    // Does bash.exe exist?\n    try {\n      await fs.access(WSL_BASH, fs.constants.F_OK);\n    } catch (e) {\n      log.warn(ENABLE_WSL);\n    }\n  }\n}\n\ntype appManagementAction =\n  | 'create'\n  | 'verify'\n  | 'revokeCerts'\n  | 'dumpDistCert'\n  | 'dumpPushCert'\n  | 'revokeProvisioningProfile';\n\nexport async function revokeProvisioningProfile(creds, metadata, teamId) {\n  const args = [\n    ('revokeProvisioningProfile': appManagementAction),\n    creds.appleId,\n    creds.password,\n    teamId,\n    metadata.bundleIdentifier,\n    metadata.experienceName,\n    '[]',\n    'false',\n  ];\n  return spawnAndCollectJSONOutputAsync(FASTLANE.app_management, args);\n}\n\nexport async function askWhichCertsToDump(creds, metadata, teamId, distOrPush, isEnterprise) {\n  const args = [\n    (distOrPush === 'distCert' && 'dumpDistCert') || (distOrPush === 'pushCert' && 'dumpPushCert'),\n    creds.appleId,\n    creds.password,\n    teamId,\n    metadata.bundleIdentifier,\n    metadata.experienceName,\n    '[]',\n    isEnterprise ? 'true' : 'false',\n  ];\n  const dumpExistingCertsAttempt = await spawnAndCollectJSONOutputAsync(\n    FASTLANE.app_management,\n    args\n  );\n  if (dumpExistingCertsAttempt.result === 'success') {\n    const { certs } = dumpExistingCertsAttempt;\n    const trimmedOneLiners = certs.map(s =>\n      s\n        .split('\\n')\n        .map(i => i.trim().replace(',', ''))\n        .join(' ')\n    );\n    if (trimmedOneLiners.length === 0) {\n      log.warn('No certs on developer.apple.com available to revoke');\n      return [];\n    }\n    const { revokeTheseCerts } = await prompt({\n      type: 'checkbox',\n      name: 'revokeTheseCerts',\n      message: `Which Certs to revoke?`,\n      choices: trimmedOneLiners,\n    });\n    const certIds = revokeTheseCerts\n      .map(s => trimmedOneLiners[trimmedOneLiners.indexOf(s)])\n      .map(s => s.split(' ')[1].split('=')[1])\n      .map(s => s.slice(1, s.length - 1));\n    return certIds;\n  } else {\n    log.warn(\n      `Unable to dump existing Apple Developer files: ${JSON.stringify(\n        dumpExistingCertsAttempt.reason\n      )}`\n    );\n    return [];\n  }\n}\n\nexport async function revokeCredentialsOnApple(creds, metadata, ids, teamId) {\n  const args = [\n    ('revokeCerts': appManagementAction),\n    creds.appleId,\n    creds.password,\n    teamId,\n    metadata.bundleIdentifier,\n    metadata.experienceName,\n  ];\n  if (process.platform === 'win32') {\n    args.push(ids.length === 0 ? '[]' : `[${ids.map(i => `\\\\\"${i}\\\\\"`).join(',')}]`);\n  } else {\n    args.push(ids.length === 0 ? '[]' : `[${ids.map(i => `\"${i}\"`).join(',')}]`);\n  }\n\n  return spawnAndCollectJSONOutputAsync(FASTLANE.app_management, args);\n}\n\nasync function spawnAndCollectJSONOutputAsync(program, args) {\n  let prgm = program;\n  let cmd = args;\n  return Promise.race([\n    new Promise((resolve, reject) => {\n      setTimeout(() => reject(new Error(timeout_msg(prgm, cmd))), TIMEOUT);\n    }),\n    new Promise((resolve, reject) => {\n      const jsonContent = [];\n      try {\n        if (process.platform === 'win32') {\n          prgm = WSL_BASH;\n          cmd = ['-c', `${WSL_ONLY_PATH} /mnt/c${windowsToWSLPath(program)} \"${args.join(' ')}\"`];\n          if (DEBUG) {\n            log.warn(`Running: bash.exe ${cmd.join(' ')}`);\n          }\n          var child = child_process.spawn(prgm, cmd, opts);\n        } else {\n          const wrapped = [`${cmd.join(' ')}`];\n          var child = child_process.spawn(prgm, wrapped, opts);\n        }\n      } catch (e) {\n        return reject(e);\n      }\n      child.stdout.on('data', d => console.log(d.toString()));\n      // This is where we get our replies back from the ruby code\n      child.stderr.on('data', d => jsonContent.push(d));\n      child.stdout.on('end', () => {\n        const rawDump = Buffer.concat(jsonContent).toString();\n        try {\n          resolve(JSON.parse(rawDump));\n        } catch (e) {\n          reject({\n            result: 'failure',\n            reason: 'Could not understand JSON reply from Ruby based local auth scripts',\n            rawDump,\n          });\n        }\n      });\n    }),\n  ]);\n}\n"],"sourceRoot":"/Users/ville/Projects/expo/universe/dev/exp/src"}